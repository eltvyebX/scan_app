{% extends "base_user.html" %}

{% block title %}Ø§Ù„ØªÙ‚Ø§Ø· Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯{% endblock %}

{% block content %}
<style>
    /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    .capture-container {
        text-align: center;
        padding: 15px;
    }

    /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© */
    .capture-title {
        font-size: 22px;
        font-weight: 700;
        color: #59287f;
        margin-bottom: 10px;
    }

    .capture-text {
        font-size: 15px;
        color: #666;
        margin-bottom: 25px;
    }

    /* Ø²Ø± Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© */
    .btn-capture {
        background-color: #59287f;
        color: #fff;
        font-weight: bold;
        padding: 14px;
        width: 100%;
        border-radius: 12px;
        font-size: 18px;
        border: none;
        margin-bottom: 15px;
    }

    .btn-capture:hover {
        background-color: #4a1f6a;
    }

    /* Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
    .btn-view {
        background-color: #ffffff;
        color: #59287f;
        font-weight: bold;
        padding: 12px;
        width: 100%;
        border-radius: 12px;
        font-size: 17px;
        border: 2px solid #59287f;
    }

    .btn-view:hover {
        background-color: #f7f3fa;
    }

    /* Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
    #camera {
        width: 100%;
        height: auto;
        border-radius: 15px;
        margin-bottom: 20px;
        background: #000;
    }

    /* Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø© */
    #captured-image {
        width: 100%;
        margin-top: 15px;
        border-radius: 12px;
        display: none;
    }

    @media (min-width: 768px) {
        .capture-container {
            max-width: 500px;
            margin: auto;
        }
    }
</style>

<div class="capture-container">

    <h2 class="capture-title">Ø§Ù„ØªÙ‚Ø§Ø· Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>
    <p class="capture-text">Ù‚Ù… Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªÙ‚Ø§Ø·.</p>

    <!-- Ø¨Ø« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <video id="camera" autoplay playsinline></video>

    <!-- Ø²Ø± Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© -->
    <button id="capture-btn" class="btn-capture">ğŸ“· Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</button>

    <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø© -->
    <img id="captured-image">

    <!-- Ø²Ø± Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <a href="/view" class="btn-view">ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>

</div>

<script>
    const camera = document.getElementById("camera");
    const captureBtn = document.getElementById("capture-btn");
    const capturedImage = document.getElementById("captured-image");

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }})
        .then(stream => camera.srcObject = stream)
        .catch(err => alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err));

    captureBtn.onclick = () => {
        const canvas = document.createElement("canvas");
        canvas.width = camera.videoWidth;
        canvas.height = camera.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(camera, 0, 0);

        const imgData = canvas.toDataURL("image/png");
        capturedImage.src = imgData;
        capturedImage.style.display = "block";

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø­ÙØ¸Ù‡Ø§ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¨Ù„Øº
        fetch("/upload_capture", {
            method: "POST",
            body: new URLSearchParams({ captured_image: imgData })
        })
        .then(res => {
            if (res.redirected) {
                window.location.href = res.url; // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© view
            } else {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±");
            }
        })
        .catch(err => {
            alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±: " + err);
        });
    };
</script>
{% endblock %}
